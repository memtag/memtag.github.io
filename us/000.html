<pre id="debug"></pre>
<script>
  async function checkUser() {
    const pageName = location.pathname.split('/').pop().split('.')[0]; // Отримуємо назву файлу без ".html"

    document.getElementById('debug').textContent = "Сторінка: " + pageName;

    try {
      const response = await fetch('users.txt?' + new Date().getTime());
      const text = await response.text();
      document.getElementById('debug').textContent += "\nusers.txt:\n" + text;

      const lines = text.split('\n');
      for (const line of lines) {
        if (line.startsWith(pageName)) {
          document.getElementById('debug').textContent += "\nЗнайдено запис: " + line;
          
          const urlMatch = line.match(/url=([^;]+)/);
          const eMatch = line.match(/e=(\d+)/);

          if (eMatch) {
            const eValue = parseInt(eMatch[1], 10);
            if (eValue === 1) {
              document.getElementById('debug').textContent += "\nВідкриваємо block.html";
              location.href = "block.html";
              return;
            }
          }

          if (urlMatch) {
            const redirectUrl = urlMatch[1].trim();
            document.getElementById('debug').textContent += "\nПеренаправлення на: " + redirectUrl;
            location.href = redirectUrl;
            return;
          }
        }
      }
    } catch (error) {
      document.getElementById('debug').textContent = "Помилка: " + error;
    }
  }

  checkUser();
</script>
