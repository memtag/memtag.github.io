<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
</title>.‚Åß</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #000;
  overflow: hidden;
  touch-action: none;
  -webkit-tap-highlight-color: transparent;
  cursor: default;
}
</style>
</head>
<body>
<script>
function getParam() {
  const q = location.search || location.href.split('?')[1] || '';
  const match = q.match(/[?&]t=([^&]+)/);
  return match ? decodeURIComponent(match[1]) : '';
}

const t = getParam();
const audio = new Audio('../sound.mp3');
audio.loop = true;
audio.preload = 'auto';
audio.volume = 0;

let ctx, gainNode;

function parseDelay(v){
  if(!v) return 0;
  if(v.endsWith('s')) return parseFloat(v)*1000;
  if(v.includes(':')){
    const now = new Date();
    const [h,m,s] = v.split(':').map(Number);
    const target = new Date();
    target.setHours(h,m||0,s||0,0);
    if(target<=now) target.setDate(target.getDate()+1);
    return target-now;
  }
  return 0;
}

function initAudio() {
  if(ctx) return;
  ctx = new (window.AudioContext||window.webkitAudioContext)();
  const src = ctx.createMediaElementSource(audio);
  gainNode = ctx.createGain();
  gainNode.gain.value = 0;
  src.connect(gainNode);
  gainNode.connect(ctx.destination);
}

function fadeTo(vol, sec=0.3){
  if(!gainNode) return;
  const now = ctx.currentTime;
  gainNode.gain.cancelScheduledValues(now);
  gainNode.gain.setValueAtTime(gainNode.gain.value, now);
  gainNode.gain.linearRampToValueAtTime(vol, now+sec);
}

document.body.addEventListener('click', async ()=>{
  initAudio();
  await ctx.resume();
  audio.currentTime = 0;
  audio.play().catch(()=>{});
  const delay = parseDelay(t);
  if(delay <= 0){
    audio.pause();
    audio.currentTime = 0;
    fadeTo(1, 0.2);
    audio.play();
  } else {
    setTimeout(()=>{
      audio.pause();
      audio.currentTime = 0;
      fadeTo(1, 0.2);
      audio.play();
    }, delay);
  }
}, { once: true });
</script>
</body>
</html>
