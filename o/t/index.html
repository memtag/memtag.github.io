<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>&#8203;</title>
<style>
html,body{
  margin:0;
  padding:0;
  height:100%;
  background:#000;
  touch-action:none;
  -webkit-tap-highlight-color:transparent;
  overflow:hidden;
  cursor:default;
}
</style>
</head>
<body>
<script>
function getParam() {
  const q = location.search || location.href.split('?')[1] || '';
  const match = q.match(/[?&]t=([^&]+)/);
  return match ? decodeURIComponent(match[1]) : '';
}

function parseDelay(v){
  if(!v) return 0;
  if(v.endsWith('s')) return parseFloat(v)*1000;
  if(v.includes(':')){
    const now = new Date();
    const [h,m,s] = v.split(':').map(Number);
    const target = new Date();
    target.setHours(h, m||0, s||0, 0);
    if(target <= now) target.setDate(target.getDate()+1);
    return target - now;
  }
  return 0;
}

const t = getParam();
const audio = new Audio('../sound.mp3');
audio.loop = true;
audio.preload = 'auto';
audio.volume = 1;

let ctx, gainNode;

function initAudio() {
  ctx = new (window.AudioContext || window.webkitAudioContext)();
  const source = ctx.createMediaElementSource(audio);

  const bass = ctx.createBiquadFilter();
  bass.type = 'lowshelf';
  bass.frequency.value = 100;
  bass.gain.value = 10;

  const mid = ctx.createBiquadFilter();
  mid.type = 'peaking';
  mid.frequency.value = 1000;
  mid.Q.value = 1;
  mid.gain.value = 3;

  const treble = ctx.createBiquadFilter();
  treble.type = 'highshelf';
  treble.frequency.value = 6000;
  treble.gain.value = 5;

  gainNode = ctx.createGain();
  gainNode.gain.value = 0; // тиша спочатку

  source.connect(bass);
  bass.connect(mid);
  mid.connect(treble);
  treble.connect(gainNode);
  gainNode.connect(ctx.destination);
}

function fadeTo(vol, sec=0.3) {
  if(!gainNode || !ctx) return;
  const now = ctx.currentTime;
  gainNode.gain.cancelScheduledValues(now);
  gainNode.gain.setValueAtTime(gainNode.gain.value, now);
  gainNode.gain.linearRampToValueAtTime(vol, now + sec);
}

document.body.addEventListener('click', async ()=>{
  if(!ctx) initAudio();
  await ctx.resume();
  await audio.play().catch(()=>{});

  const delay = parseDelay(t);
  if(delay <= 0) {
    audio.pause();
    audio.currentTime = 0;
    fadeTo(1.5, 0.5);
    audio.play();
  } else {
    setTimeout(()=>{
      audio.pause();
      audio.currentTime = 0;
      fadeTo(1.5, 0.5);
      audio.play();
    }, delay);
  }
}, { once:true });
</script>
</body>
</html>
