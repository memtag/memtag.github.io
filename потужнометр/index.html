<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–ü–æ—Ç—É–∂–Ω–æ–º–µ—Ç—Ä –£–∫—Ä–∞—ó–Ω–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: linear-gradient(to bottom, #0057b7, #ffd700);
      color: #111;
      font-family: 'Comic Sans MS', cursive;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 {
      margin-top: 20px;
      font-size: 2.5em;
      color: white;
      text-shadow: 2px 2px 4px #000;
    }

    #gaugeBox {
      position: relative;
      width: 300px;
      height: 160px;
      margin: 30px auto;
    }

    canvas {
      width: 100%;
      height: 100%;
    }

    #needle {
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 4px;
      height: 140px;
      background: black;
      transform-origin: bottom center;
      transform: rotate(-90deg);
      transition: transform 0.3s ease-out;
    }

    #powerLabel {
      font-size: 1.5em;
      margin-top: 10px;
      font-weight: bold;
    }

    select, input, button {
      margin: 10px;
      padding: 10px;
      font-size: 1em;
      border-radius: 8px;
      border: 2px solid #222;
    }

    .section {
      margin: 20px;
    }

    .ukraine {
      margin-top: 20px;
      font-size: 1.2em;
      color: #003399;
      font-weight: bold;
    }

    .flag {
      font-size: 2em;
    }
  </style>
</head>
<body>
  <h1>–ü–æ—Ç—É–∂–Ω–æ–º–µ—Ç—Ä –£–∫—Ä–∞—ó–Ω–∏</h1>

  <div id="gaugeBox">
    <canvas id="gauge" width="300" height="150"></canvas>
    <div id="needle"></div>
  </div>

  <div id="powerLabel">–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å: 0%</div>

  <div class="section">
    <label for="sensor">–î–∞—Ç—á–∏–∫:</label>
    <select id="sensor">
      <option value="manual">–î–∞—Ç—á–∏–∫ "–¢–∏ —à–æ, –Ω–µ —à–∞—Ä–∏—à?" (—Ä—É—á–Ω–∏–π)</option>
      <option value="accel">–î–∞—Ç—á–∏–∫ "–ó–µ–º–ª—è —Ç—ñ–∫–∞—î" (–∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä)</option>
      <option value="mic">–î–∞—Ç—á–∏–∫ "–ì—É—á–Ω—ñ—Å—Ç—å –∑—Ä–∞–¥–∏" (–º—ñ–∫—Ä–æ—Ñ–æ–Ω)</option>
    </select>
  </div>

  <div class="section" id="manualBox">
    <label>–†—É—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è:</label>
    <input type="range" id="manualValue" min="0" max="100" value="0">
  </div>

  <button onclick="readSensor()">–í–∏–º—ñ—Ä—è—Ç–∏ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å</button>

  <div class="ukraine">–°–ª–∞–≤–∞ –£–∫—Ä–∞—ó–Ω—ñ! <span class="flag">üá∫üá¶</span></div>

  <script>
    const ctx = document.getElementById("gauge").getContext("2d");
    const needle = document.getElementById("needle");
    const powerLabel = document.getElementById("powerLabel");
    const sensorSelect = document.getElementById("sensor");
    const manualBox = document.getElementById("manualBox");

    const zones = [
      { color: "#00cc00", label: "–ó—Ä–∞–¥–∞", from: 0, to: 20 },
      { color: "#ffff00", label: "–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ", from: 20, to: 40 },
      { color: "#ff9900", label: "–ü–æ—Ç—É–∂–Ω–æ", from: 40, to: 60 },
      { color: "#ff0000", label: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å", from: 60, to: 85 },
      { color: "#800000", label: "–ü–æ—Ç—É–∂–Ω–æ–º–µ—Ç—Ä —Ä–æ–∑ º—ó–±–∞–ª–æ", from: 85, to: 100 }
    ];

    function drawGauge() {
      const centerX = 150;
      const centerY = 150;
      const radius = 140;
      let start = Math.PI;

      zones.forEach(zone => {
        const startAngle = start + Math.PI * (zone.from / 100);
        const endAngle = start + Math.PI * (zone.to / 100);

        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.fillStyle = zone.color;
        ctx.fill();
      });
    }

    function updatePower(value) {
      const angle = -90 + (value / 100) * 180;
      needle.style.transform = `rotate(${angle}deg)`;
      powerLabel.innerText = `–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å: ${Math.round(value)}%`;
    }

    function readSensor() {
      const mode = sensorSelect.value;
      if (mode === "manual") {
        const val = document.getElementById("manualValue").value;
        updatePower(val);
      } else if (mode === "accel") {
        if (window.DeviceMotionEvent) {
          window.addEventListener("devicemotion", function (event) {
            const acc = event.accelerationIncludingGravity;
            const total = Math.sqrt(acc.x * acc.x + acc.y * acc.y + acc.z * acc.z);
            const power = Math.min(100, (total - 9.8) * 10);
            updatePower(power);
          }, { once: true });
        } else {
          alert("–ê–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è.");
        }
      } else if (mode === "mic") {
        navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
          const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          const source = audioCtx.createMediaStreamSource(stream);
          const analyser = audioCtx.createAnalyser();
          analyser.fftSize = 256;
          const dataArray = new Uint8Array(analyser.frequencyBinCount);
          source.connect(analyser);
          analyser.getByteFrequencyData(dataArray);
          let avg = dataArray.reduce((a, b) => a + b) / dataArray.length;
          stream.getTracks().forEach(t => t.stop());
          updatePower(Math.min(100, avg * 1.5));
        }).catch(() => alert("–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞."));
      }
    }

    sensorSelect.addEventListener("change", () => {
      manualBox.style.display = sensorSelect.value === "manual" ? "block" : "none";
    });

    drawGauge();
    updatePower(0);
  </script>
</body>
</html>
