<!doctype html>

<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NFC Web</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;padding:0;background:#121212;color:#e0e0e0;display:flex;flex-direction:column;min-height:100vh;}
    #splash{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#1e1e1e;}
    #splash img{width:150px;height:150px;margin-bottom:20px;}
    #splash h1{font-size:1.8rem;margin:0;color:#fff;}
    .panel{background:#1e1e1e;padding:20px;margin:20px auto;border-radius:10px;max-width:720px;box-shadow:0 2px 8px rgba(0,0,0,0.5);}
    label{display:block;margin:10px 0 5px;font-weight:600;}
    input, select, button{padding:10px;margin-bottom:10px;border-radius:6px;border:1px solid #555;width:100%;background:#2c2c2c;color:#e0e0e0;}
    button{background:#4a90e2;color:white;border:none;cursor:pointer;transition:0.3s;}
    button:hover{background:#357abd;}
    .subpanel{display:none;}
    #lang-select{position:absolute;top:20px;right:20px;width:100px;}
    footer{margin-top:auto;background:#1e1e1e;padding:20px;text-align:center;display:flex;justify-content:center;gap:20px;}
    footer a{display:inline-block;padding:10px 20px;background:#4a90e2;color:white;border-radius:6px;text-decoration:none;transition:0.3s;}
    footer a:hover{background:#357abd;}
  </style>
</head>
<body>
  <select id="lang-select">
    <option value="auto">Авто</option>
    <option value="ua">UA</option>
    <option value="en">EN</option>
    <option value="ru">RU</option>
  </select>  <div id="splash">
    <img src="nfc.png" alt="NFC">
    <h1 id="splash-text">ПРИКЛАДІТЬ МІТКУ</h1>
  </div>  <div class="panel" id="tag-panel" style="display:none">
    <pre id="tag-info">Дані з тегу...</pre>
    <label for="record-type">Що записати:</label>
    <select id="record-type">
      <option value="text">Текст</option>
      <option value="url">Посилання</option>
      <option value="sound">Звук</option>
    </select>
    <div class="subpanel" id="text-panel">
      <input id="write-text" placeholder="Текст для запису"/>
    </div>
    <div class="subpanel" id="url-panel">
      <input id="write-url" placeholder="https://example.com"/>
    </div>
    <div class="subpanel" id="sound-panel">
      <select id="write-sound"></select>
    </div>
    <button id="btn-write">Записати вибране</button>
    <button id="btn-clear">Очистити тег</button>
  </div>  <footer>
    <a href="https://tiktok.com/@mem.tag" target="_blank">TikTok @mem.tag</a>
    <a href="https://t.me/mem_soundtag" target="_blank">Telegram</a>
  </footer>  <script>
    const splash = document.getElementById('splash');
    const splashText = document.getElementById('splash-text');
    const tagPanel = document.getElementById('tag-panel');
    const tagInfo = document.getElementById('tag-info');
    const writeText = document.getElementById('write-text');
    const writeUrl = document.getElementById('write-url');
    const writeSound = document.getElementById('write-sound');
    const btnWrite = document.getElementById('btn-write');
    const btnClear = document.getElementById('btn-clear');
    const recordTypeSel = document.getElementById('record-type');
    const textPanel = document.getElementById('text-panel');
    const urlPanel = document.getElementById('url-panel');
    const soundPanel = document.getElementById('sound-panel');
    const langSelect = document.getElementById('lang-select');

    let ndef = null;

    function getBrowserLang(){
      const lang = navigator.language.slice(0,2);
      if(['ua','uk'].includes(lang)) return 'ua';
      if(['ru'].includes(lang)) return 'ru';
      return 'en';
    }

    function showSubPanel(){
      textPanel.style.display='none';
      urlPanel.style.display='none';
      soundPanel.style.display='none';
      if(recordTypeSel.value==='text') textPanel.style.display='block';
      else if(recordTypeSel.value==='url') urlPanel.style.display='block';
      else if(recordTypeSel.value==='sound') soundPanel.style.display='block';
    }

    recordTypeSel.addEventListener('change', showSubPanel);

    async function loadSounds(){
      try{
        const resp = await fetch('snd.txt');
        const text = await resp.text();
        const lines = text.split('\n');
        lines.forEach(line=>{
          const m = line.match(/name="([^"]+)"\s+page="([^"]+)"/);
          if(m){
            const opt = document.createElement('option');
            opt.value = `https://memtag.github.io/${m[2]}/`;
            opt.textContent = m[1];
            writeSound.appendChild(opt);
          }
        });
      }catch(e){
        console.log('Не вдалося завантажити snd.txt');
      }
    }

    async function startScan(){
      if(!('NDEFReader' in window)){
        splashText.textContent='Ваш браузер не підтримує NFC';
        return;
      }
      ndef = new NDEFReader();
      try{
        await ndef.scan();
        splashText.textContent='ПРИКЛАДІТЬ МІТКУ';
        ndef.onreading = event => {
          const serial = event.serialNumber || '00 00 00 00';
          let contentArr = [];
          for(const record of event.message.records){
            try{
              if(record.recordType==='text') contentArr.push(new TextDecoder().decode(record.data));
              else if(record.recordType==='url') contentArr.push(new TextDecoder().decode(record.data));
              else contentArr.push('');
            }catch(e){
              contentArr.push('');
            }
          }

          let contentStr;
          if(contentArr.length===0 || contentArr.every(c=>c==='')) contentStr='Порожнє';
          else if(contentArr.every(c=>/^https?:\/\//.test(c))) contentStr='URL';
          else if(contentArr.every(c=>c!=='' && !/^https?:\/\//.test(c))) contentStr='Text';
          else contentStr='Змішане';

          splash.style.display='none';
          tagPanel.style.display='block';
          tagInfo.textContent = `UID: ${serial}\nТип: ${contentStr}\nЗміст: ${contentStr==='Змішане' ? 'невідомий' : contentArr.join(', ')}`;
        };
      }catch(e){
        splashText.textContent='Помилка при скануванні: '+e;
      }
    }

    btnWrite.addEventListener('click', async ()=>{
      if(!ndef) return;
      splash.style.display='flex';
      splashText.textContent='Очікую Мітку';
      const type = recordTypeSel.value;
      let records = [];
      if(type==='text' && writeText.value.trim()) records.push({recordType:'text', data:writeText.value.trim()});
      else if(type==='url' && writet
