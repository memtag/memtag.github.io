<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MemTag NFC</title>
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      text-align: center;
    }
    #lang-select {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #1e1e1e;
      color: #fff;
      border: none;
      padding: 5px 10px;
      border-radius: 6px;
    }
    img {
      width: 200px;
      height: 200px;
      margin-bottom: 20px;
    }
    .info {
      font-size: 18px;
      margin-top: 10px;
      word-break: break-all;
    }
    .actions {
      margin-top: 20px;
    }
    .btn {
      background: #333;
      color: #eee;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      margin: 5px;
      font-size: 16px;
    }
    .btn:hover {
      background: #444;
    }
    footer {
      position: fixed;
      bottom: 10px;
      display: flex;
      gap: 15px;
    }
    footer button {
      background: #2c2c2c;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 18px;
      font-size: 16px;
    }
    footer button:hover {
      background: #3a3a3a;
    }
  </style>
</head>
<body>
  <select id="lang-select">
    <option value="ua">UA</option>
    <option value="en">EN</option>
    <option value="ru">RU</option>
  </select>

  <img src="nfc.png" alt="NFC">
  <h2 id="status">Прикладіть мітку</h2>
  <div class="info" id="uid"></div>
  <div class="info" id="type"></div>
  <div class="info" id="content"></div>

  <div class="actions">
    <button class="btn" id="writeText">Записати текст</button>
    <button class="btn" id="writeUrl">Записати посилання</button>
    <button class="btn" id="clearTag">Очистити тег</button>
  </div>

  <footer>
    <button onclick="window.open('https://tiktok.com/@mem.tag','_blank')">TikTok</button>
    <button onclick="window.open('https://t.me/mem_soundtag','_blank')">Telegram</button>
  </footer>

  <script>
    const lang = navigator.language.startsWith('ru') ? 'ru' :
                 navigator.language.startsWith('en') ? 'en' : 'ua';
    document.getElementById('lang-select').value = lang;

    const texts = {
      ua: {
        touch: "Прикладіть мітку",
        waiting: "Очікую мітку...",
        unsupported: "Ваш браузер не підтримує NFC",
        uid: "UID:",
        type: "Тип:",
        content: "Зміст:",
        mixed: "Змішаний"
      },
      en: {
        touch: "Tap a tag",
        waiting: "Waiting for tag...",
        unsupported: "Your browser doesn't support NFC",
        uid: "UID:",
        type: "Type:",
        content: "Content:",
        mixed: "Mixed"
      },
      ru: {
        touch: "Приложите метку",
        waiting: "Ожидаю метку...",
        unsupported: "Ваш браузер не поддерживает NFC",
        uid: "UID:",
        type: "Тип:",
        content: "Содержимое:",
        mixed: "Смешанное"
      }
    };

    function t(key) {
      const current = document.getElementById('lang-select').value;
      return texts[current][key];
    }

    const statusEl = document.getElementById('status');
    const uidEl = document.getElementById('uid');
    const typeEl = document.getElementById('type');
    const contentEl = document.getElementById('content');

    async function startNFC() {
      if (!('NDEFReader' in window)) {
        statusEl.textContent = t('unsupported');
        return;
      }

      try {
        const ndef = new NDEFReader();
        await ndef.scan();
        statusEl.textContent = t('touch');

        ndef.onreading = event => {
          navigator.vibrate(100);
          const uid = event.serialNumber || "—";
          let type = "";
          let content = "";

          if (!event.message.records.length) {
            type = "—";
            content = "—";
          } else {
            const records = event.message.records;
            const types = [...new Set(records.map(r => r.recordType))];
            if (types.length > 1) type = t('mixed');
            else if (types[0] === "url") type = "URL";
            else if (types[0] === "text") type = "Text";
            else type = t('mixed');

            const decoder = new TextDecoder();
            content = records.map(r => decoder.decode(r.data)).join(" ");
          }

          uidEl.textContent = t('uid') + " " + uid;
          typeEl.textContent = t('type') + " " + type;
          contentEl.textContent = t('content') + " " + (type === t('mixed') ? "Невідомий" : content);
        };
      } catch (err) {
        statusEl.textContent = t('unsupported');
      }
    }

    async function writeNFC(data) {
      if (!('NDEFReader' in window)) {
        statusEl.textContent = t('unsupported');
        return;
      }
      try {
        statusEl.textContent = t('waiting');
        const ndef = new NDEFReader();
        await ndef.write(data);
        statusEl.textContent = t('touch');
      } catch (e) {
        statusEl.textContent = "Помилка запису";
      }
    }

    document.getElementById('writeText').onclick = () => {
      const txt = prompt("Введіть текст для запису:");
      if (txt) writeNFC({ records: [{ recordType: "text", data: txt }] });
    };
    document.getElementById('writeUrl').onclick = () => {
      const url = prompt("Введіть посилання для запису:");
      if (url) writeNFC({ records: [{ recordType: "url", data: url }] });
    };
    document.getElementById('clearTag').onclick = () => writeNFC({ records: [] });

    document.getElementById('lang-select').onchange = () => {
      statusEl.textContent = t('touch');
      uidEl.textContent = "";
      typeEl.textContent = "";
      contentEl.textContent = "";
    };

    startNFC();
  </script>
</body>
</html>
